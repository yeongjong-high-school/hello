<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>TODO ìº˜ë¦°ë” & ì¹œí™˜ê²½ ì±Œë¦°ì§€</title>
  <style>
    /* --- ê³µí†µ Body ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans KR', 'Arial', sans-serif; /* ë‘ í°íŠ¸ ëª¨ë‘ í¬í•¨, Noto Sans KR ìš°ì„  */
      background-color: #f0f4f8; /* ìº˜ë¦°ë” ë°°ê²½ìƒ‰ ê¸°ë³¸ ì‚¬ìš© */
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: #333; /* ì±Œë¦°ì§€ ê¸°ë³¸ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
    }

    /* --- ë„¤ë¹„ê²Œì´ì…˜ ë°” ìŠ¤íƒ€ì¼ --- */
    #main-nav {
      width: 100%;
      text-align: center;
      padding: 20px 0;
      background-color: #e8f5e9; /* ì±Œë¦°ì§€ ë„¤ë¹„ ë°°ê²½ìƒ‰ ì‚¬ìš© */
      box-sizing: border-box;
      margin-bottom: 20px;
      border-bottom: 2px solid #a8d5ba;
    }
    #main-nav a {
      font-weight: bold;
      text-decoration: none;
      font-size: 1.2em; /* í¬ê¸° ì‚´ì§ í‚¤ì›€ */
      padding: 10px 20px; /* íŒ¨ë”© ì¡°ì • */
      border-radius: 8px;
      transition: background-color 0.3s, color 0.3s;
      margin: 0 10px;
      color: #2e7d32; /* ê¸°ë³¸ ë§í¬ ìƒ‰ìƒ */
    }
    #main-nav a.active {
      background-color: #388e3c;
      color: #ffffff;
    }
    #main-nav a:not(.active):hover {
      background-color: #c8e6c9;
    }

    /* --- ì„¹ì…˜ ê³µí†µ ìŠ¤íƒ€ì¼ --- */
    .content-section {
      width: 100%;
      display: flex; /* ë‚´ë¶€ ì»¨í…ì¸  ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•´ */
      flex-direction: column;
      align-items: center;
    }


    /* --- TODO ìº˜ë¦°ë” ì„¹ì…˜ ìŠ¤íƒ€ì¼ --- */
    #calendar-section {
      /* ì´ ì„¹ì…˜ì€ ë‚´ë¶€ ìš”ì†Œë“¤ì´ max-widthë¥¼ ê°€ì§ */
    }
    #calendar-section header { /* ìº˜ë¦°ë”ì˜ header íƒœê·¸ */
      width: 100%;
      max-width: 480px;
      background-color: #a8d5ba;
      color: #2a5d4e;
      text-align: center;
      padding: 20px 0;
      font-size: 2.5rem;
      font-weight: bold;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      border-radius: 12px;
      user-select: none;
      margin-bottom: 20px;
    }
    #calendar-section .calendar {
      width: 100%;
      max-width: 480px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
      padding: 20px;
      user-select: none;
      box-sizing: border-box;
    }
    #calendar-section .calendar-header {
      text-align: center;
      font-weight: 600;
      color: #2a5d4e;
      font-size: 1.3rem;
      margin-bottom: 12px;
    }
    #calendar-section .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      color: #7cb99e;
      font-weight: 600;
      margin-bottom: 8px;
      user-select: none;
    }
    #calendar-section .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }
    #calendar-section .calendar-day {
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      font-weight: 500;
      user-select: none;
      border: 2px solid transparent;
      transition: background-color 0.3s ease, border-color 0.3s ease;
      min-height: 50px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      box-sizing: border-box;
    }
    #calendar-section .calendar-day:hover {
      background-color: #d6eadf;
    }
    #calendar-section .calendar-day.today {
      border-color: #7cb99e;
      font-weight: 700;
      background-color: #e8f5e9;
    }
    #calendar-section .calendar-day.selected {
      background-color: #a8d5ba;
      color: white;
      font-weight: 700;
    }
    #calendar-section .calendar-day.selected .todo-preview {
        color: #f0f4f8;
    }
    #calendar-section .calendar-day.empty {
      cursor: default;
      background-color: transparent;
      border-color: transparent;
    }
    #calendar-section .calendar-day.empty:hover {
      background-color: transparent;
    }
    #calendar-section .todo-preview {
      font-size: 0.75rem;
      color: #4b7053;
      margin-top: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      padding: 0 2px;
    }
    #calendar-section .todo-container {
      margin-top: 20px;
      width: 100%;
      max-width: 480px;
      box-sizing: border-box;
    }
    #calendar-section .todo-container h2 {
      color: #2a5d4e;
      font-weight: 700;
      margin-bottom: 10px;
      user-select: none;
      font-size: 1.5rem;
    }
    #calendar-section .input-area {
      display: flex;
      margin-bottom: 15px;
    }
    #calendar-section #input { /* ID ì‚¬ìš© */
      flex-grow: 1;
      padding: 12px 15px;
      font-size: 1.1rem;
      border: 2px solid #a8d5ba;
      border-radius: 8px 0 0 8px;
      outline: none;
      transition: border-color 0.3s ease;
    }
    #calendar-section #input:focus {
      border-color: #7cb99e;
      box-shadow: 0 0 8px rgba(124,185,158,0.5);
    }
    #calendar-section #add-btn { /* ID ì‚¬ìš© */
      padding: 12px 20px;
      font-size: 1.1rem;
      background-color: #a8d5ba;
      color: #2a5d4e;
      border: none;
      border-radius: 0 8px 8px 0;
      cursor: pointer;
      transition: background-color 0.3s ease;
      font-weight: 600;
    }
    #calendar-section #add-btn:hover {
      background-color: #7cb99e;
    }
    #calendar-section #add-btn:disabled {
        background-color: #d0d0d0;
        cursor: not-allowed;
    }
    #calendar-section #output { /* ID ì‚¬ìš© */
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 280px;
      overflow-y: auto;
    }
    #calendar-section #output::-webkit-scrollbar { width: 8px; }
    #calendar-section #output::-webkit-scrollbar-track { background: #f0f4f8; border-radius: 4px; }
    #calendar-section #output::-webkit-scrollbar-thumb { background: #a8d5ba; border-radius: 4px; }
    #calendar-section #output::-webkit-scrollbar-thumb:hover { background: #7cb99e; }
    #calendar-section #output li {
      background-color: white;
      border: 1px solid #a8d5ba;
      border-radius: 8px;
      padding: 14px 18px;
      font-size: 1.1rem;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      user-select: none;
      transition: background-color 0.2s ease, border-color 0.2s ease;
      position: relative;
    }
    #calendar-section #output li.done {
      text-decoration: line-through;
      color: #7cb99e;
      border-color: #d6eadf;
      background-color: #e8f5e9;
    }
    #calendar-section #output li.done span { opacity: 0.7; }
    #calendar-section #output li input[type="checkbox"] {
      margin-right: 15px;
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: #2a5d4e;
    }
    #calendar-section #output li span {
        flex-grow: 1;
        word-break: break-all;
    }
    #calendar-section .delete-btn {
        background: none;
        border: none;
        color: #ff6b6b;
        font-size: 1.2rem;
        font-weight: bold;
        cursor: pointer;
        padding: 5px;
        margin-left: 10px;
        opacity: 0.5;
        transition: opacity 0.2s ease;
    }
    #calendar-section #output li:hover .delete-btn { opacity: 1; }


    /* --- ì¹œí™˜ê²½ ì±Œë¦°ì§€ ì„¹ì…˜ ìŠ¤íƒ€ì¼ --- */
    #challenge-section {
      padding: 0 20px 30px 20px; /* ìƒí•˜ì¢Œìš° íŒ¨ë”© ì¡°ì • */
      box-sizing: border-box;
      width: 100%;
    }
    #challenge-section h1, #challenge-section h2 { /* ì±Œë¦°ì§€ h1, h2 */
      color: #2e7d32;
      text-align: center;
      margin-bottom: 30px;
      text-shadow: 1px 1px 3px #a5d6a7;
    }
    #challenge-section #challengeContainer {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    #challenge-section .challenge {
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(46, 125, 50, 0.15);
      padding: 20px 25px;
      width: 100%; /* ëª¨ë°”ì¼ì—ì„œ ê½‰ì°¨ê²Œ */
      max-width: 300px; /* ìµœëŒ€ ë„ˆë¹„ */
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      user-select: none;
      box-sizing: border-box;
    }
    #challenge-section .challenge:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 15px rgba(46, 125, 50, 0.3);
    }
    #challenge-section .challenge input[type="checkbox"] {
      margin-right: 18px;
      width: 22px;
      height: 22px;
      cursor: pointer;
      accent-color: #388e3c;
    }
    #challenge-section .challenge span {
      font-size: 16px;
      line-height: 1.4;
      flex: 1;
    }
    #challenge-section #points {
      text-align: center;
      font-size: 22px;
      color: #1b5e20;
      margin-bottom: 40px;
      font-weight: 600;
      text-shadow: 1px 1px 2px #a5d6a7;
    }
    #challenge-section #items, #challenge-section #certifyFeed {
      max-width: 700px;
      margin: 0 auto 30px auto;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }
    #challenge-section .item {
      background: #e8f5e9;
      border: 2px solid #a5d6a7;
      border-radius: 12px;
      padding: 15px 20px;
      width: 100%; /* ëª¨ë°”ì¼ì—ì„œ ê½‰ì°¨ê²Œ */
      max-width: 200px; /* ìµœëŒ€ ë„ˆë¹„ */
      box-shadow: 0 3px 6px rgba(165, 214, 167, 0.4);
      display: flex;
      flex-direction: column;
      align-items: center;
      font-weight: 600;
      color: #2e7d32;
      user-select: none;
      transition: background 0.3s ease;
      box-sizing: border-box;
    }
    #challenge-section .item button {
      margin-top: 12px;
      padding: 8px 14px;
      background-color: #388e3c;
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: background-color 0.25s ease;
    }
    #challenge-section .item button:hover {
      background-color: #2e7d32;
    }
    #challenge-section #purchasedItems {
      max-width: 700px;
      margin: 0 auto 40px auto;
      padding-left: 20px;
      color: #33691e;
      font-weight: 600;
      font-size: 16px;
      list-style-type: disc;
    }
    #challenge-section #purchasedItems li { margin-bottom: 5px; }
    #challenge-section #resetBtn {
      display: block;
      margin: 30px auto;
      background-color: #4caf50;
      border: none;
      padding: 14px 26px;
      font-size: 18px;
      color: white;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      box-shadow: 0 5px 12px rgba(76, 175, 80, 0.5);
      transition: background-color 0.3s ease;
      user-select: none;
    }
    #challenge-section #resetBtn:hover {
      background-color: #388e3c;
    }
    #challenge-section #certifyForm {
        max-width:700px;
        margin:0 auto 30px;
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(46, 125, 50, 0.1);
    }
    #challenge-section #certifyForm textarea {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
      box-sizing: border-box;
    }
    #challenge-section #certifyForm input[type="file"] {
      margin-bottom: 10px;
      display: block;
    }
    #challenge-section #postBtn { /* ì±Œë¦°ì§€ì˜ postBtn */
      padding: 10px 20px;
      background-color: #2e7d32;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.25s ease;
    }
    #challenge-section #postBtn:hover {
        background-color: #1b5e20;
    }
    #challenge-section #certifyFeed div.feed-card {
      width: 100%;
      box-sizing: border-box;
      background: white;
      border: 1px solid #c8e6c9;
      border-radius: 12px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      padding: 15px 20px;
      display: flex;
      flex-direction: column;
      margin-bottom: 15px; /* ì¹´ë“œ ê°„ ê°„ê²© */
    }
  </style>
</head>
<body>

  <nav id="main-nav">
    <a href="#" id="nav-calendar" class="active">TODO ìº˜ë¦°ë”</a>
    <a href="#" id="nav-challenge">ì¹œí™˜ê²½ ì±Œë¦°ì§€</a>
  </nav>

  <div id="calendar-section" class="content-section">
    <header>2025ë…„ 5ì›” TODO ìº˜ë¦°ë”</header>
    <div class="calendar">
      <div class="calendar-header">2025ë…„ 5ì›”</div>
      <div class="calendar-weekdays">
        <div>ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div>
      </div>
      <div class="calendar-days" id="calendar-days"></div>
    </div>
    <div class="todo-container">
      <h2 id="selected-date-title">ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
      <div class="input-area">
        <input id="input" type="text" placeholder="í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" disabled />
        <button id="add-btn" disabled>ì¶”ê°€</button>
      </div>
      <ul id="output"></ul>
    </div>
  </div>

  <div id="challenge-section" class="content-section" style="display: none;">
    <h1>ì¹œí™˜ê²½ ì±Œë¦°ì§€</h1>
    <div id="challengeContainer"></div>
    <div id="points">í¬ì¸íŠ¸: 0</div>
    <h2>êµ¬ë§¤ ê°€ëŠ¥í•œ ì•„ì´í…œ</h2>
    <div id="items"></div>
    <h2>êµ¬ë§¤ ë‚´ì—­</h2>
    <ul id="purchasedItems"></ul>
    <button id="resetBtn">ìƒˆ ì±Œë¦°ì§€ ì‹œì‘í•˜ê¸°</button>
    <h2>ì±Œë¦°ì§€ ì¸ì¦í•˜ê¸°</h2>
    <div id="certifyForm">
      <textarea id="certifyText" rows="4" placeholder="ì±Œë¦°ì§€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì˜¤ëŠ˜ í…€ë¸”ëŸ¬ ì‚¬ìš© ì¸ì¦!)"></textarea>
      <input type="file" id="certifyImage" accept="image/*">
      <button id="postBtn">ì¸ì¦ ê²Œì‹œ</button>
    </div>
    <h2>ì¸ì¦ í”¼ë“œ</h2>
    <div id="certifyFeed"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- ë„¤ë¹„ê²Œì´ì…˜ ë° ì„¹ì…˜ ì „í™˜ ë¡œì§ ---
      const navCalendarLink = document.getElementById('nav-calendar');
      const navChallengeLink = document.getElementById('nav-challenge');
      const calendarSectionDiv = document.getElementById('calendar-section');
      const challengeSectionDiv = document.getElementById('challenge-section');

      function showCalendarSection() {
        calendarSectionDiv.style.display = 'flex'; // ìº˜ë¦°ë” ì„¹ì…˜ì€ flexë¡œ ì •ë ¬
        challengeSectionDiv.style.display = 'none';
        navCalendarLink.classList.add('active');
        navChallengeLink.classList.remove('active');
      }

      function showChallengeSection() {
        calendarSectionDiv.style.display = 'none';
        challengeSectionDiv.style.display = 'block'; // ì±Œë¦°ì§€ ì„¹ì…˜ì€ block
        navCalendarLink.classList.remove('active');
        navChallengeLink.classList.add('active');
      }

      navCalendarLink.addEventListener('click', (e) => {
        e.preventDefault();
        showCalendarSection();
      });

      navChallengeLink.addEventListener('click', (e) => {
        e.preventDefault();
        showChallengeSection();
      });

      // --- TODO ìº˜ë¦°ë” ìŠ¤í¬ë¦½íŠ¸ ---
      const calendarDaysEl = document.getElementById('calendar-days');
      const calendarSelectedDateTitle = document.getElementById('selected-date-title'); // ì´ë¦„ ë³€ê²½ (ì¶©ëŒ ë°©ì§€)
      const calendarInput = document.getElementById('input'); // ì´ë¦„ ë³€ê²½
      const calendarAddBtn = document.getElementById('add-btn'); // ì´ë¦„ ë³€ê²½
      const calendarOutput = document.getElementById('output'); // ì´ë¦„ ë³€ê²½

      const calendarYear = 2025;
      const calendarMonth = 4; // 5ì›”ì€ 4 (0ë¶€í„° ì‹œì‘)
      const calendarToday = new Date();

      let calendarSelectedDate = null;
      let calendarTodosByDate = {};

      function calendarLoadTodos() {
        const saved = localStorage.getItem('todosByDate_2025_May');
        if (saved) calendarTodosByDate = JSON.parse(saved);
      }

      function calendarSaveTodos() {
        localStorage.setItem('todosByDate_2025_May', JSON.stringify(calendarTodosByDate));
      }

      function calendarFormatDate(year, month, day) {
        return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
      }

      function calendarRenderCalendar() {
        calendarDaysEl.innerHTML = '';
        const firstDayOfMonth = new Date(calendarYear, calendarMonth, 1).getDay();
        const lastDateOfMonth = new Date(calendarYear, calendarMonth + 1, 0).getDate();

        for (let i = 0; i < firstDayOfMonth; i++) {
          const emptyCell = document.createElement('div');
          emptyCell.classList.add('calendar-day', 'empty');
          calendarDaysEl.appendChild(emptyCell);
        }

        for (let day = 1; day <= lastDateOfMonth; day++) {
          const dateCell = document.createElement('div');
          dateCell.classList.add('calendar-day');
          const dateStr = calendarFormatDate(calendarYear, calendarMonth, day);
          dateCell.innerHTML = `<div>${day}</div>`;

          const todosForDay = calendarTodosByDate[dateStr] || [];
          if (todosForDay.length > 0) {
            const preview = document.createElement('div');
            preview.className = 'todo-preview';
            let previewText = todosForDay[0].text;
            if (previewText.length > 8) previewText = previewText.slice(0, 8) + 'â€¦';
            preview.textContent = previewText;
            if (todosForDay[0].done) {
              preview.style.textDecoration = 'line-through';
              preview.style.color = '#aaa';
            }
            if (todosForDay.length > 1) {
               preview.textContent += ` ì™¸ ${todosForDay.length -1}ê°œ`;
            }
            dateCell.appendChild(preview);
          }

          if (calendarToday.getFullYear() === calendarYear && calendarToday.getMonth() === calendarMonth && calendarToday.getDate() === day) {
            dateCell.classList.add('today');
          }
          if (calendarSelectedDate === dateStr) {
            dateCell.classList.add('selected');
          }

          dateCell.addEventListener('click', () => {
            const previouslySelected = calendarDaysEl.querySelector('.selected');
            if (previouslySelected) previouslySelected.classList.remove('selected');
            dateCell.classList.add('selected');
            calendarSelectedDate = dateStr;
            calendarRenderTodos();
            calendarInput.disabled = false;
            calendarAddBtn.disabled = false;
            calendarInput.focus();
          });
          calendarDaysEl.appendChild(dateCell);
        }
      }

      function calendarRenderTodos() {
        calendarOutput.innerHTML = '';
        if (!calendarSelectedDate) {
          calendarSelectedDateTitle.textContent = 'ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”';
          calendarInput.value = '';
          calendarInput.disabled = true;
          calendarAddBtn.disabled = true;
          return;
        }
        calendarSelectedDateTitle.textContent = `${calendarSelectedDate} í•  ì¼ ëª©ë¡`;
        const todos = calendarTodosByDate[calendarSelectedDate] || [];

        if (todos.length === 0) {
          const emptyMsg = document.createElement('li');
          emptyMsg.textContent = 'í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤. ì¶”ê°€í•´ë³´ì„¸ìš”!';
          emptyMsg.style.cssText = 'text-align:center; color:#888; cursor:default; border:none; background:transparent;';
          calendarOutput.appendChild(emptyMsg);
          return;
        }

        todos.forEach((todo, index) => {
          const li = document.createElement('li');
          if (todo.done) li.classList.add('done');
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.checked = todo.done;
          checkbox.addEventListener('change', () => {
            todos[index].done = checkbox.checked;
            calendarSaveTodos();
            calendarRenderTodos();
            calendarRenderCalendar();
          });
          const span = document.createElement('span');
          span.textContent = todo.text;
          const deleteBtn = document.createElement('button');
          deleteBtn.classList.add('delete-btn');
          deleteBtn.innerHTML = 'Ã—';
          deleteBtn.title = "ì‚­ì œ";
          deleteBtn.addEventListener('click', () => calendarDeleteTodo(index));
          li.appendChild(checkbox);
          li.appendChild(span);
          li.appendChild(deleteBtn);
          calendarOutput.appendChild(li);
        });
      }

      function calendarAddTodo() {
        const text = calendarInput.value.trim();
        if (!text || !calendarSelectedDate) return;
        if (!calendarTodosByDate[calendarSelectedDate]) calendarTodosByDate[calendarSelectedDate] = [];
        calendarTodosByDate[calendarSelectedDate].push({ text, done: false });
        calendarSaveTodos();
        calendarRenderTodos();
        calendarRenderCalendar();
        calendarInput.value = '';
        calendarInput.focus();
      }

      function calendarDeleteTodo(index) {
        if (!calendarSelectedDate || !calendarTodosByDate[calendarSelectedDate]) return;
        calendarTodosByDate[calendarSelectedDate].splice(index, 1);
        if (calendarTodosByDate[calendarSelectedDate].length === 0) delete calendarTodosByDate[calendarSelectedDate];
        calendarSaveTodos();
        calendarRenderTodos();
        calendarRenderCalendar();
      }

      calendarAddBtn.addEventListener('click', calendarAddTodo);
      calendarInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !calendarInput.disabled) calendarAddTodo();
      });

      calendarLoadTodos();
      calendarRenderCalendar();
      calendarRenderTodos();

      // --- ì¹œí™˜ê²½ ì±Œë¦°ì§€ ìŠ¤í¬ë¦½íŠ¸ ---
      const challengeContainer = document.getElementById("challengeContainer");
      const pointsDisplay = document.getElementById("points");
      const itemsDiv = document.getElementById("items");
      const purchasedList = document.getElementById("purchasedItems");
      const challengeResetBtn = document.getElementById("resetBtn"); // ì´ë¦„ ë³€ê²½
      const challengePostBtn = document.getElementById("postBtn"); // ì´ë¦„ ë³€ê²½
      const certifyText = document.getElementById("certifyText");
      const certifyImageInput = document.getElementById("certifyImage");
      const certifyFeed = document.getElementById("certifyFeed");

      const allChallenges = [
        "ì¬í™œìš© ë¶„ë¦¬ìˆ˜ê±° ì² ì €íˆ í•˜ê¸°", "ì¼íšŒìš©í’ˆ ì‚¬ìš© ì¤„ì´ê¸° (ë¹„ë‹ë´‰íˆ¬, í”Œë¼ìŠ¤í‹± ì»µ ë“±)", "ëŒ€ì¤‘êµí†µ ì´ìš©í•˜ê±°ë‚˜ ìì „ê±° íƒ€ê¸°",
        "í”Œë¼ìŠ¤í‹± ë¹¨ëŒ€ ë° ì‹ê¸°ë¥˜ ì‚¬ìš©í•˜ì§€ ì•Šê¸°", "ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì „ë“± ë° ì „ìê¸°ê¸° í”ŒëŸ¬ê·¸ ë½‘ê¸°", "í…€ë¸”ëŸ¬ ë˜ëŠ” ê°œì¸ì»µ ì‚¬ìš©í•˜ê¸°",
        "ì¼ì£¼ì¼ì— í•˜ë£¨ ì±„ì‹ ë„ì „í•˜ê¸°", "ì¹œí™˜ê²½ ì¸ì¦ ì œí’ˆ êµ¬ë§¤í•˜ê¸° (ì„¸ì œ, í™”ì¥í’ˆ ë“±)", "ì´ë©´ì§€ ì‚¬ìš© ë° ì¢…ì´ ì²­êµ¬ì„œ ëŒ€ì‹  ì „ìëª…ì„¸ì„œ ë°›ê¸°",
        "í•˜ë£¨ 30ë¶„ ë™ë„¤ ê³µì› ë˜ëŠ” ìì—° ì† ê±·ê¸°", "ì§§ì€ ê±°ë¦¬ëŠ” ê±·ê±°ë‚˜ ìì „ê±° ì´ìš©í•˜ê¸°", "ë¬¼ ì ˆì•½í•˜ê¸° (ì–‘ì¹˜ì»µ ì‚¬ìš©, ìƒ¤ì›Œ ì‹œê°„ ì¤„ì´ê¸°)"
      ];
      const storeItems = [
        { name: "ì¹œí™˜ê²½ ì”¨ì•— ì—°í•„ ì„¸íŠ¸", cost: 30 }, { name: "ëŒ€ë‚˜ë¬´ ì¹«ì†” (2ê°œì…)", cost: 20 },
        { name: "íœ´ëŒ€ìš© ì ‘ì´ì‹ ì—ì½”ë°±", cost: 50 }, { name: "ì²œì—° ì£¼ë°© ì„¸ì œ ë¦¬í•„ (500ml)", cost: 40 },
        { name: "ì—…ì‚¬ì´í´ë§ ë¯¸ë‹ˆ í™”ë¶„", cost: 60 }
      ];
      let challengePoints = 0; // ì´ë¦„ ë³€ê²½
      let challengePurchased = []; // ì´ë¦„ ë³€ê²½
      let challengeCurrentChallenges = []; // ì´ë¦„ ë³€ê²½

      function challengeSaveData() {
        localStorage.setItem('ecoChallengePoints', challengePoints);
        localStorage.setItem('ecoChallengePurchased', JSON.stringify(challengePurchased));
        localStorage.setItem('ecoChallengeCurrentChallenges', JSON.stringify(challengeCurrentChallenges));
      }

      function challengeLoadData() {
        const savedPoints = localStorage.getItem('ecoChallengePoints');
        if (savedPoints !== null) challengePoints = parseInt(savedPoints);
        const savedPurchased = localStorage.getItem('ecoChallengePurchased');
        if (savedPurchased) challengePurchased = JSON.parse(savedPurchased);
        const savedChallenges = localStorage.getItem('ecoChallengeCurrentChallenges');
        if (savedChallenges) challengeCurrentChallenges = JSON.parse(savedChallenges);
        challengeUpdatePointsDisplay();
        challengeUpdatePurchasedItems();
        if (challengeCurrentChallenges.length > 0) challengeRenderChallenges(false);
        else challengeStartNewChallenges();
        challengeLoadCertifyFeed();
      }

      function challengeUpdatePointsDisplay() {
        pointsDisplay.textContent = `í¬ì¸íŠ¸: ${challengePoints}`;
      }

      function challengeUpdatePurchasedItems() {
        purchasedList.innerHTML = "";
        challengePurchased.forEach(item => {
          const li = document.createElement("li");
          li.textContent = item;
          purchasedList.appendChild(li);
        });
      }

      function challengeShowStoreItems() {
        itemsDiv.innerHTML = "";
        storeItems.forEach(item => {
          const itemDiv = document.createElement("div");
          itemDiv.className = "item";
          const itemName = document.createElement("span");
          itemName.textContent = `${item.name} (ê°€ê²©: ${item.cost} í¬ì¸íŠ¸)`;
          const buyBtn = document.createElement("button");
          buyBtn.textContent = "êµ¬ë§¤í•˜ê¸°";
          buyBtn.addEventListener("click", () => {
            if (challengePoints >= item.cost) {
              challengePoints -= item.cost;
              challengeUpdatePointsDisplay();
              challengePurchased.push(item.name);
              challengeUpdatePurchasedItems();
              alert(`${item.name}ì„(ë¥¼) êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤!`);
              challengeSaveData();
            } else alert("í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
          });
          itemDiv.appendChild(itemName);
          itemDiv.appendChild(buyBtn);
          itemsDiv.appendChild(itemDiv);
        });
      }

      function challengeGetRandomChallengeIndices(count, excludeIndices = []) {
        const availableIndices = allChallenges.map((_, i) => i).filter(i => !excludeIndices.includes(i));
        const selectedIndices = [];
        while (selectedIndices.length < count && availableIndices.length > 0) {
          const randomIndex = Math.floor(Math.random() * availableIndices.length);
          selectedIndices.push(availableIndices.splice(randomIndex, 1)[0]);
        }
        return selectedIndices;
      }

      function challengeRenderChallenges(isNewSet = true) {
        challengeContainer.innerHTML = "";
        if (isNewSet) {
          const currentChallengeTexts = challengeCurrentChallenges.map(c => c.text);
          const excludeIndices = allChallenges.map((text, i) => (currentChallengeTexts.includes(text) ? i : -1)).filter(i => i !== -1);
          let newIndices = challengeGetRandomChallengeIndices(3, excludeIndices);
          if (newIndices.length < 3 && allChallenges.length > 3) {
            const numToReplace = 3 - newIndices.length;
            const indicesToKeep = challengeCurrentChallenges.slice(0, challengeCurrentChallenges.length - numToReplace).map(c => c.originalIndex);
            const replacementIndices = challengeGetRandomChallengeIndices(numToReplace, [...excludeIndices, ...indicesToKeep]);
            newIndices.push(...replacementIndices);
          }
          challengeCurrentChallenges = newIndices.map((originalIndex, i) => ({
            text: allChallenges[originalIndex], originalIndex: originalIndex, id: `challenge-${Date.now()}-${i}`
          }));
        }
        if (challengeCurrentChallenges.length === 0) {
          challengeContainer.textContent = "ëª¨ë“  ì±Œë¦°ì§€ë¥¼ ì™„ë£Œí–ˆê±°ë‚˜, í‘œì‹œí•  ì±Œë¦°ì§€ê°€ ì—†ìŠµë‹ˆë‹¤!";
          challengeSaveData(); return;
        }
        challengeCurrentChallenges.forEach(challengeData => {
          const label = document.createElement("label");
          label.className = "challenge"; label.htmlFor = challengeData.id;
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox"; checkbox.id = challengeData.id;
          checkbox.addEventListener("change", () => {
            if (checkbox.checked) {
              challengePoints += 10; challengeUpdatePointsDisplay();
              const challengeIndexInCurrent = challengeCurrentChallenges.findIndex(c => c.id === challengeData.id);
              if (challengeIndexInCurrent !== -1) {
                const excludeIndicesForNew = challengeCurrentChallenges.map(c => c.originalIndex);
                const newSingleIndexArr = challengeGetRandomChallengeIndices(1, excludeIndicesForNew);
                if (newSingleIndexArr.length > 0) {
                  challengeCurrentChallenges[challengeIndexInCurrent] = {
                    text: allChallenges[newSingleIndexArr[0]], originalIndex: newSingleIndexArr[0],
                    id: `challenge-${Date.now()}-${challengeIndexInCurrent}`
                  };
                } else {
                  challengeCurrentChallenges.splice(challengeIndexInCurrent, 1);
                  if (challengeCurrentChallenges.length === 0) alert("ëª¨ë“  ì±Œë¦°ì§€ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!");
                }
              }
              challengeRenderChallenges(false); challengeSaveData();
            }
          });
          label.appendChild(checkbox);
          const span = document.createElement("span");
          span.textContent = challengeData.text;
          label.appendChild(span);
          challengeContainer.appendChild(label);
        });
        challengeSaveData();
      }

      function challengeStartNewChallenges() {
        challengeCurrentChallenges = [];
        challengeRenderChallenges(true);
      }
      challengeResetBtn.addEventListener("click", challengeStartNewChallenges);

      function challengeSaveCertifyFeed() {
        const feedItems = [];
        certifyFeed.querySelectorAll('.feed-card').forEach(card => {
          const text = card.querySelector('p')?.textContent || "";
          const imgSrc = card.querySelector('img')?.src || "";
          feedItems.push({text, imgSrc});
        });
        localStorage.setItem('ecoCertifyFeed', JSON.stringify(feedItems.slice(0, 10)));
      }

      function challengeLoadCertifyFeed() {
        const savedFeed = localStorage.getItem('ecoCertifyFeed');
        if (savedFeed) {
          const feedItems = JSON.parse(savedFeed);
          feedItems.forEach(item => challengeCreateCertifyPost(item.text, item.imgSrc, false));
        }
      }

      function challengeCreateCertifyPost(text, imgSrc, shouldSave = true) {
        const card = document.createElement("div"); card.className = "feed-card";
        if (text) {
          const content = document.createElement("p"); content.textContent = text;
          content.style.cssText = "margin-bottom:10px; font-weight:500;"; card.appendChild(content);
        }
        if (imgSrc) {
          const img = document.createElement("img"); img.src = imgSrc;
          img.style.cssText = `max-width:100%; max-height:300px; object-fit:cover; border-radius:8px; margin-top:${text ? '10px' : '0'};`;
          card.appendChild(img);
        }
        const likeSection = document.createElement("div");
        likeSection.style.cssText = "margin-top:12px; display:flex; align-items:center; gap:8px;";
        const likeBtn = document.createElement("button");
        likeBtn.innerHTML = "â¤ï¸ <span class='text'>ì¢‹ì•„ìš”</span>";
        likeBtn.style.cssText = "padding:6px 12px; border:1px solid #ddd; border-radius:20px; cursor:pointer; background-color:#f0f0f0; font-weight:600;";
        likeBtn.dataset.liked = "false";
        const likeCount = document.createElement("span");
        likeCount.textContent = "0"; likeCount.style.fontWeight = "500";
        likeBtn.addEventListener("click", () => {
          let count = parseInt(likeCount.textContent);
          if (likeBtn.dataset.liked === "false") {
            likeCount.textContent = count + 1; likeBtn.dataset.liked = "true";
            likeBtn.style.backgroundColor = "#a5d6a7"; likeBtn.style.color = "#1b5e20";
            likeBtn.innerHTML = "ğŸ’š <span class='text'>ì¢‹ì•„ìš”</span>";
          }
          if(shouldSave) challengeSaveCertifyFeed();
        });
        likeSection.appendChild(likeBtn); likeSection.appendChild(likeCount); card.appendChild(likeSection);

        const commentSection = document.createElement("div");
        commentSection.style.cssText = "margin-top:15px; border-top:1px solid #eee; padding-top:10px;";
        const commentList = document.createElement("div");
        commentList.style.cssText = "display:flex; flex-direction:column; gap:6px; margin-bottom:10px; max-height:100px; overflow-y:auto;";
        const commentInput = document.createElement("input");
        commentInput.type = "text"; commentInput.placeholder = "ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”...";
        commentInput.style.cssText = "padding:8px 10px; border:1px solid #ccc; border-radius:20px; width:calc(100% - 90px); margin-right:8px;";
        const commentBtn = document.createElement("button");
        commentBtn.textContent = "ë“±ë¡";
        commentBtn.style.cssText = "padding:8px 15px; border:none; border-radius:20px; cursor:pointer; background-color:#c8e6c9; color:#2e7d32; font-weight:600;";
        commentBtn.addEventListener("click", () => {
          const commentText = commentInput.value.trim();
          if (commentText) {
            const comment = document.createElement("div");
            comment.textContent = `ğŸ’¬ ${commentText}`;
            comment.style.cssText = "padding:6px 10px; background-color:#f1f8e9; border-radius:15px; font-size:14px; word-break:break-all;";
            commentList.appendChild(comment); commentInput.value = "";
            commentList.scrollTop = commentList.scrollHeight;
            if(shouldSave) challengeSaveCertifyFeed();
          }
        });
        const commentInputArea = document.createElement("div");
        commentInputArea.style.display = "flex"; commentInputArea.style.alignItems = "center";
        commentInputArea.appendChild(commentInput); commentInputArea.appendChild(commentBtn);
        commentSection.appendChild(commentList); commentSection.appendChild(commentInputArea); card.appendChild(commentSection);
        certifyFeed.prepend(card);
        if(shouldSave) challengeSaveCertifyFeed();
      }

      challengePostBtn.addEventListener("click", () => {
        const text = certifyText.value.trim();
        const imageFile = certifyImageInput.files[0];
        if (!text && !imageFile) { alert("ë‚´ìš© ë˜ëŠ” ì´ë¯¸ì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”!"); return; }
        if (imageFile) {
          const reader = new FileReader();
          reader.onload = (e) => challengeCreateCertifyPost(text, e.target.result);
          reader.readAsDataURL(imageFile);
        } else challengeCreateCertifyPost(text, null);
        certifyText.value = ""; certifyImageInput.value = "";
      });

      challengeLoadData();
      challengeShowStoreItems();

      // ì´ˆê¸° ì„¹ì…˜ í‘œì‹œ
      showCalendarSection(); // ê¸°ë³¸ìœ¼ë¡œ ìº˜ë¦°ë” ì„¹ì…˜ í‘œì‹œ
    });
  </script>
</body>
</html>